<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALUspend Wise - Tests</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        .test-section { margin: 2rem 0; padding: 1rem; border: 1px solid #ccc; }
        .test-result { margin: 0.5rem 0; padding: 0.5rem; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        button { margin: 0.5rem; padding: 0.5rem 1rem; }
    </style>
</head>
<body>
    <h1>ALUspend Wise - Test Suite</h1>
    
    <div class="test-section">
        <h2>Validation Tests</h2>
        <div id="validation-tests"></div>
        <button onclick="runValidationTests()">Run Validation Tests</button>
    </div>
    
    <div class="test-section">
        <h2>Storage Tests</h2>
        <div id="storage-tests"></div>
        <button onclick="runStorageTests()">Run Storage Tests</button>
    </div>
    
    <div class="test-section">
        <h2>Search Tests</h2>
        <div id="search-tests"></div>
        <button onclick="runSearchTests()">Run Search Tests</button>
    </div>

    <script>
        // Debug function to check if modules are loaded
        function checkModules() {
            console.log('Validators:', window.Validators);
            console.log('Storage:', window.Storage);
            console.log('Search:', window.Search);
        }

        function addTestResult(sectionId, testName, passed, message = '') {
            const section = document.getElementById(sectionId);
            const result = document.createElement('div');
            result.className = `test-result ${passed ? 'pass' : 'fail'}`;
            result.innerHTML = `<strong>${testName}:</strong> ${passed ? 'PASS' : 'FAIL'} ${message}`;
            section.appendChild(result);
        }

        window.runValidationTests = function() {
            const section = document.getElementById('validation-tests');
            section.innerHTML = '';
            
            if (!window.Validators) {
                addTestResult('validation-tests', 'Module Check', false, 'Validators module not loaded');
                return;
            }
            
            // Test description validation
            const descTests = [
                { input: 'Coffee', expected: true },
                { input: ' Coffee', expected: false },
                { input: 'Coffee ', expected: false },
                { input: 'Coffee  shop', expected: false },
                { input: '', expected: false }
            ];
            
            descTests.forEach(test => {
                const result = window.Validators.validate(test.input, 'description');
                addTestResult('validation-tests', 
                    `Description: "${test.input}"`, 
                    result === test.expected,
                    `Expected: ${test.expected}, Got: ${result}`
                );
            });
        };

        window.runStorageTests = function() {
            const section = document.getElementById('storage-tests');
            section.innerHTML = '';
            
            if (!window.Storage) {
                addTestResult('storage-tests', 'Module Check', false, 'Storage module not loaded');
                return;
            }
            
            // Test save and load
            const testData = { test: 'data', number: 123 };
            window.Storage.save('test-key', testData);
            const loadedData = window.Storage.load('test-key');
            
            addTestResult('storage-tests',
                'Save and Load',
                JSON.stringify(loadedData) === JSON.stringify(testData),
                `Expected: ${JSON.stringify(testData)}, Got: ${JSON.stringify(loadedData)}`
            );
        };

        window.runSearchTests = function() {
            const section = document.getElementById('search-tests');
            section.innerHTML = '';
            
            if (!window.Search) {
                addTestResult('search-tests', 'Module Check', false, 'Search module not loaded');
                return;
            }
            
            const testTransactions = [
                { id: '1', description: 'Coffee shop', category: 'Food', amount: 5.50, date: '2023-09-01' },
                { id: '2', description: 'Book store', category: 'Education', amount: 25.00, date: '2023-09-02' },
                { id: '3', description: 'Tea house', category: 'Food', amount: 8.75, date: '2023-09-03' }
            ];
            
            // Test basic search
            const basicResults = window.Search.basicSearch(testTransactions, 'coffee');
            addTestResult('search-tests',
                'Basic Search',
                basicResults.length === 1 && basicResults[0].description === 'Coffee shop',
                `Expected 1 result, Got: ${basicResults.length}`
            );
            
            // Test regex search - FIXED: Use proper regex pattern
            const regexResults = window.Search.regexSearch(testTransactions, 'coffee|tea');
            addTestResult('search-tests',
                'Regex Search',
                regexResults.results.length === 2,
                `Expected 2 results, Got: ${regexResults.results.length}`
            );
            
            // Test invalid regex fallback
            const invalidResults = window.Search.regexSearch(testTransactions, '/invalid[regex/');
            addTestResult('search-tests',
                'Invalid Regex Fallback',
                invalidResults.results.length === 0,
                `Expected 0 results, Got: ${invalidResults.results.length}`
            );
        };

        // Load modules dynamically to avoid CORS issues
        async function loadModules() {
            try {
                // Adjust these paths according to your actual file structure
                const { Validators } = await import('./scripts/validators.js');
                const { Storage } = await import('./scripts/storage.js');
                const { Search } = await import('./scripts/search.js');
                
                window.Validators = Validators;
                window.Storage = Storage;
                window.Search = Search;
                
                console.log('All modules loaded successfully');
            } catch (error) {
                console.error('Error loading modules:', error);
                // Fallback: create mock objects for testing
                window.Validators = window.Validators || { validate: () => false };
                window.Storage = window.Storage || { 
                    save: () => {}, 
                    load: () => null, 
                    remove: () => {} 
                };
                window.Search = window.Search || { 
                    basicSearch: () => [], 
                    regexSearch: () => ({ results: [] }) 
                };
            }
        }

        // Initialize when page loads
        loadModules();
    </script>
</body>
</html>
